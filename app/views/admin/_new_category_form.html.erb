<div class="container">
    <%= form_tag(@category.persisted? ? admin_category_path(@category) : '/admin/categories', 
               method: @category.persisted? ? :put : :post, 
               class: 'formtastic product', 
               novalidate: true) do %>
    <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

    <h1><%= @category.persisted? ? "Edit Model" : "New Model" %></h1>
    <fieldset class="form-group">
        <% if @category.errors.any? %>
        <div class="alert alert-danger">
            <ul>
                <% @category.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
                <% end %>
            </ul>
        </div>
        <% end %>

        <div class="form-row mt-4">

            <div class="form-group col-md-12">
                <%= label_tag 'category[brand_id]', "Brand", class: 'control-label' %>
                <%= collection_select :category, :brand_id, Brand.all, :id, :name, { prompt: "Select Brand" }, {class: 'form-control', required: true} %>
                <% if @category.errors[:brand_id].any? %>
                <div class="text-danger">
                    <%= @category.errors[:brand_id].join(', ') %>
                </div>
                <% end %>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-12" id="device_div" style="display: <%= @category.persisted? ? 'block' : 'none' %>;">
                <%= label_tag '', "Device", class: 'control-label' %>
                <select id="category_device_id" name="category[device_id]" class="form-control">
                    <option value=""> Select Device</option>
                    <% if @category.device_id.present? %>
                    <option value="<%= @category.device_id %>" selected="selected">
                        <%= @category.device.name %>
                    </option>
                    <% end %>
                </select>
            </div>
                            <p style="display: none" id="no-device"> No Device Found in this Brand</p>

        </div>
        <div id="new-category-form" style="display: <%= @category.persisted? ? 'block' : 'none'%>">
            <div class="form-row mt-4">
                <div class="form-group col-md-12">
                    <%= label_tag 'category[name]', "Name", class: 'control-label' %>
                    <%= text_field_tag 'category[name]', @category.name, class: 'form-control', required: true, placeholder: "Enter category name" %>
                    <% if @category.errors[:name].any? %>
                    <div class="text-danger">
                        <%= @category.errors[:name].join(', ') %>
                    </div>
                    <% end %>
                </div>
            </div>

            <!-- Submit and Cancel Buttons -->
            <div class="form-row">
                <div class="form-group col-md-2 d-flex">
                    <%= submit_tag @category.persisted? ? 'Update Category' : 'Create Category', 
                         class: 'btn btn-primary py-2 mr-2' %>
                    <%= link_to 'Cancel', '/admin/categories', class: 'btn btn-secondary' %>
                </div>
            </div>
        </div>
    </fieldset>
    <% end %>
</div>
<script>
$(document).ready(function() {
  $("#page_title").text("New Model");
});
</script>